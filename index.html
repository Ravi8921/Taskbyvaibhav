<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Appointment</title>
    <!-- Include Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Book an Appointment</h1>
        
        <!-- Appointment Form -->
        <form id="appointmentForm">
            <!-- Full Name Input -->
            <div class="form-group">
                <label for="fullName">Full Name</label>
                <input type="text" class="form-control" id="fullName" placeholder="Enter your full name">
            </div>
            
            <!-- Email Input -->
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" class="form-control" id="email" placeholder="Enter your email">
            </div>
            
            <!-- Phone Number Input -->
            <div class="form-group">
                <label for="phone">Phone Number</label>
                <input type="tel" class="form-control" id="phone" placeholder="Enter your phone number">
            </div>
            
            <!-- Appointment Date Input -->
            <div class="form-group">
                <label for="appointmentDate">Appointment Date</label>
                <input type="date" class="form-control" id="appointmentDate">
            </div>
            
            <!-- Hidden input for appointment ID -->
            <input type="hidden" id="appointmentId" value="">
            
            <!-- Submit Button -->
            <button type="submit" class="btn btn-primary">Book Appointment</button>
        </form>

        <!-- List of Appointments -->
        <h2 class="mt-4">Appointments</h2>
        <ul id="appointmentList" class="list-group">
            <!-- Appointments will be dynamically added here -->
        </ul>
    </div>

    <!-- Include Bootstrap JS and jQuery (for form validation) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    
    <!-- Include Axios for making API requests -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
        // Function to fetch and display data from the API
        function fetchData() {
            // Replace the placeholder URL with your actual API endpoint
            axios.get("https://crudcrud.com/api/f52fb0fc98704096b135d0f5f4300bf1/newappoint")
                .then(response => {
                    const data = response.data;
                    const appointmentList = document.getElementById("appointmentList");
                    appointmentList.innerHTML = ""; // Clear the existing list

                    data.forEach(appointment => {
                        const listItem = document.createElement("li");
                        listItem.className = "list-group-item";
                        listItem.setAttribute("data-id", appointment._id); // Add data-id attribute

                        listItem.innerHTML = `
                            <strong>${appointment.fullName}</strong><br>
                            Email: ${appointment.email}<br>
                            Phone: ${appointment.phone}<br>
                            Appointment Date: ${appointment.appointmentDate}
                        `;

                        // Add an edit icon
                        const editButton = document.createElement("button");
                        editButton.className = "btn btn-info btn-sm float-right edit-btn";
                        editButton.textContent = "Edit";

                        editButton.addEventListener("click", function() {
                            // Call the editAppointment function when the edit button is clicked
                            editAppointment(appointment);
                        });

                        listItem.appendChild(editButton);
                        appointmentList.appendChild(listItem);
                    });
                })
                .catch(error => {
                    console.error("Error fetching data:", error);
                });
        }

        // Function to delete an appointment by _id
        function deleteAppointment(appointmentId) {
            // Replace the placeholder URL with your actual API endpoint
            axios.delete(`https://crudcrud.com/api/f52fb0fc98704096b135d0f5f4300bf1/newappoint/${appointmentId}`)
                .then(response => {
                    // If deletion is successful, remove the user detail from the website's UI
                    const deletedItem = document.querySelector(`[data-id="${appointmentId}"]`);
                    if (deletedItem) {
                        deletedItem.remove();
                    }
                })
                .catch(error => {
                    console.error("Error deleting appointment:", error);
                });
        }

        // Function to save an appointment to localStorage
        function saveAppointmentToStorage(appointment) {
            const appointments = getStoredAppointments();
            appointments.push(appointment);
            localStorage.setItem("appointments", JSON.stringify(appointments));
        }

        // Function to remove an appointment from localStorage
        function removeAppointmentFromStorage(appointment) {
            const appointments = getStoredAppointments();
            const updatedAppointments = appointments.filter(
                storedAppointment => JSON.stringify(storedAppointment) !== JSON.stringify(appointment)
            );
            localStorage.setItem("appointments", JSON.stringify(updatedAppointments));
        }

        // Function to get stored appointments from localStorage
        function getStoredAppointments() {
            const appointments = localStorage.getItem("appointments");
            return appointments ? JSON.parse(appointments) : [];
        }

        // Function to populate the main registration form with user details for editing
        function editAppointment(appointment) {
            document.getElementById("fullName").value = appointment.fullName;
            document.getElementById("email").value = appointment.email;
            document.getElementById("phone").value = appointment.phone;
            document.getElementById("appointmentDate").value = appointment.appointmentDate;

            // Store the appointment ID in a hidden field for later use
            document.getElementById("appointmentId").value = appointment._id;
        }

        // Modify the form submission event listener to update the user details
        document.getElementById("appointmentForm").addEventListener("submit", function(event) {
            event.preventDefault();

            // Get input values
            const fullName = document.getElementById("fullName").value;
            const email = document.getElementById("email").value;
            const phone = document.getElementById("phone").value;
            const appointmentDate = document.getElementById("appointmentDate").value;
            const appointmentId = document.getElementById("appointmentId").value;

            // Create a new appointment object with updated details
            const updatedAppointment = {
                fullName,
                email,
                phone,
                appointmentDate
            };

            // Send a PUT request to update the user details
            axios.put(`https://crudcrud.com/api/f52fb0fc98704096b135d0f5f4300bf1/newappoint/${appointmentId}`, updatedAppointment)
                .then(response => {
                    // After updating, fetch and display updated data
                    fetchData();
                })
                .catch(error => {
                    console.error("Error updating appointment:", error);
                });

            // Clear the form inputs
            document.getElementById("fullName").value = "";
            document.getElementById("email").value = "";
            document.getElementById("phone").value = "";
            document.getElementById("appointmentDate").value = "";
            document.getElementById("appointmentId").value = ""; // Clear the hidden field
        });

        // Call the fetchData function to initially load data
        fetchData();

        // Load appointments from localStorage when the page loads
        const storedAppointments = getStoredAppointments();
        storedAppointments.forEach(appointment => {
            saveAppointmentToStorage(appointment);
        });
    </script>
</body>
</html>
